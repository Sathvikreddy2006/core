{%load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Faculty Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/facultyDashboard.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-
4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT
" crossorigin="anonymous">
    <style>
        #logout {
            margin: 20px;
            height: auto;
            width: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            align-content: center;
        }

        #facultyLogOut {
            background-color: #25D366;
            height: 35px;
            width: 120px;
            border-radius: 9px;
            border: 0.3px solid black;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            transition-duration: 0.5s;
        }

        #facultyLogout:hover {
            background-color: #25D366;
            transform: scale(1.5);
            border-radius: 9px;
            border: 0.3px solid black;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
        }
    </style>
</head>

<body>
    <h1>Faculty Dashboard</h1>
    <div class="dashboard-container">
        <!-- QR Code Section -->
        <div class="qr-section">
            <h2>Scan This QR Code</h2>
            {% if qr_code %}
            <img src="{{ qr_code }}" alt="QR Code">
            {% endif %}
        </div>
        <!-- Attendance Table Section -->
        <div class="attendance-section">
            <h2>Students Who Marked Attendance</h2>
            <table id="attendanceTable" class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Hall Ticket</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamically filled via JS -->
                </tbody>
            </table>
        </div>
    </div>
    <div id="container">
        <div id="logout">
            <a href="{% url 'download_attendance_excel' session.id %}" id="facultyLogOut">
                Download Excel
            </a>
            <form action="{% url 'facultyLogout' %}" method="post">
                {% csrf_token %}
                <button type="submit" id="facultyLogOut">Logout</button>
            </form>

        </div>
        <script>
            function fetchAttendance() {
                fetch(`/get_attendance_records/{{ session.id }}/`)
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.querySelector("#attendanceTable tbody");
                        tbody.innerHTML = "";
                        data.records.forEach(record => {
                            const row = `<tr>
 <td>${record.name}</td>
 <td>${record.hall_ticket}</td>
 <td>${record.timestamp}</td>
 </tr>`;
                            tbody.innerHTML += row;
                        });
                    });
            }
            setInterval(fetchAttendance, 5000);
            window.onload = fetchAttendance;
        </script>
</body>

</html>